"use strict";StackExchange.mockups=function(){function e(e,t,i,s,n){function a(e,t,i){for(var s=-1,n=-1;;){if(n=t.indexOf(e,n+1),-1==n)break;(0>s||Math.abs(n-i)<Math.abs(n-s))&&(s=n)}return s}return e.replace(new RegExp("<!-- Begin mockup[^>]*? -->\\s*!\\[[^\\]]*\\]\\((http://[^ )]+)[^)]*\\)\\s*<!-- End mockup -->","g"),function(e,o,r){var c={"payload":o.replace(/[^-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]/g,""),"pos":a(e,t,r),"len":e.length};return-1===c.pos?e:(n.push(c),e+"\n\n"+i+s+"-"+(n.length-1)+"%")})}function t(){StackExchange.externalEditor.init({"thingName":"mockup","thingFinder":e,"getIframeUrl":function(e){var t="/plugins/mockups/editor";return e&&(t+="?edit="+encodeURIComponent(e)),t},"buttonTooltip":"UI wireframe","buttonImageUrl":"/content/balsamiq/wmd-mockup-button.png?v=4","onShow":function(e){window.addMockupToEditor=e},"onRemove":function(){window.addMockupToEditor=null;try{delete window.addMockupToEditor}catch(e){}}})}return{"init":t}}(),StackExchange.schematics=function(){function e(){if(!window.postMessage)return s;var e=document.createElement("div");e.innerHTML="<svg/>";var t="http://www.w3.org/2000/svg"==(e.firstChild&&e.firstChild.namespaceURI);if(!t)return s;var i=navigator.userAgent;return/Firefox|Chrome/.test(i)?o:/Apple/.test(navigator.vendor)||/Opera/.test(i)?a:n}function t(e,t,i,s,n){function a(e,t,i){for(var s=-1,n=-1;;){if(n=t.indexOf(e,n+1),-1==n)break;(0>s||Math.abs(n-i)<Math.abs(n-s))&&(s=n)}return s}return e.replace(new RegExp("<!-- Begin schematic[^>]*? -->\\s*!\\[[^\\]]*\\]\\((http://[^ )]+)[^)]*\\)\\s*<!-- End schematic -->","g"),function(e,o,r){var c={"payload":o.replace(/[^-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]/g,""),"pos":a(e,t,r),"len":e.length};return-1===c.pos?e:(n.push(c),e+"\n\n"+i+s+"-"+(n.length-1)+"%")})}function i(){var i;StackExchange.externalEditor.init({"thingName":"schematic","thingFinder":t,"getIframeUrl":function(e){var t="/plugins/schematics/editor";return e&&(t+="?edit="+encodeURIComponent(e)),t},"buttonTooltip":"Schematic","buttonImageUrl":"/content/electronics/img/wmd-schematic-button.png?v=1","checkSupport":function(){var t=e();switch(t){case o:return!0;case a:return confirm("Your browser is not officially supported by the schematics editor; however it has been reported to work. Launch the editor?");case n:return confirm("Your browser is not officially supported by the schematics editor; it may or may not work. Launch the editor anyway?");case s:return alert("Sorry, your browser does not support all the necessary features for the schematics editor."),!1}},"onShow":function(e){var t=$("<div class='popup' />").css("z-index",1111).text("Loading editor").appendTo("body").show().addSpinner({"marginLeft":5}).center({"dy":-200});$("<div style='text-align:right;margin-top: 10px' />").append($("<button>cancel</button>").click(function(){t.remove(),e()})).appendTo(t),i=function(i){if(i=i.originalEvent,"https://www.circuitlab.com"===i.origin){i.data||e();var s=$.parseJSON(i.data);if(s&&"success"===s.load)return t.remove(),void 0;if(s&&s.edit_url&&s.image_url){s.fkey=StackExchange.options.user.fkey;var n=$("<div class='popup' />").css("z-index",1111).appendTo("body").show(),a=function(){n.text("Storing image").addSpinner({"marginLeft":5}).center(),$.post("/plugins/schematics/save",s).done(function(t){n.remove(),e(t.img)}).fail(function(e){if(409===e.status){var t="Storing aborted";e.responseText.length<200&&(t=e.responseText),n.text(t+", will retry shortly").addSpinner({"marginLeft":5}).center(),setTimeout(a,1e4)}else n.remove(),alert("Failed to upload the schematic image.")})};a()}}},$(window).on("message",i)},"onRemove":function(){$(window).off("message",i)}})}var s=0,n=1,a=2,o=3;return{"init":i}}(),StackExchange.externalEditor=function(){function e(e){function t(e,t){function d(t){function s(){StackExchange.helpers.closePopups(x.add(n)),h()}var n,r=m||v.caret(),c=v[0].value||"",u=t?t.pos:r.start,d=t?t.len:r.end-r.start,g=c.substring(0,u),p=c.substring(u+d);m=null;var f=function(t,n){if(!t)return setTimeout(s,0),v.focus(),void 0;StackExchange.navPrevention.start();var a=void 0===n?i(t):n,o=g.replace(/(?:\r\n|\r|\n){1,2}$/,""),c=o+a+p.replace(/^(?:\r\n|\r|\n){1,2}/,""),l=r.start+a.length-g.length+o.length;setTimeout(function(){e.textOperation(function(){v.val(c).focus().caret(l,l)}),s()},0)},x=null;if(a){var k=a(t?t.payload:null);x=$("<iframe>",{"src":k})}else{var b=o(t?t.payload:null);x=$(b)}x.addClass("esc-remove").css({"position":"fixed","top":"2.5%","left":"2.5%","width":"95%","height":"95%","background":"white","z-index":1001}),$("body").loadPopup({"html":x,"target":$("body"),"lightbox":!0}).done(function(){$(window).resize(),l(f)})}$('<style type="text/css"> .wmd-'+s+"-button span { background-position: 0 0; } .wmd-"+s+"-button:hover span { background-position: 0 -40px; }</style>)").appendTo("head");var g,p,m,f=e.getConverter().hooks,v=$("#wmd-input"+t);f.chain("preConversion",function(e){var t=(e.match(/%/g)||[]).length,i=v[0].value||"";return g=new Array(t+2).join("%"),p=[],n(e,i,g,s,p)}),f.chain("postConversion",function(e){return e.replace(new RegExp(g+s+"-(\\d+)%","g"),function(e,t){return"<sup><a href='#' class='edit-"+s+"' data-id='"+t+"'>edit the above "+s+"</a></sup>"})});var x="The "+s+" editor does not support touch devices.",k=!1;$("#wmd-preview"+t).on("touchend",function(){k=!0}).on("click","a.edit-"+s,function(){return k?(alert(x),k=!1,!1):(k=!1,(!u||u())&&d(p[$(this).attr("data-id")]),!1)}),$("#wmd-input"+t).keyup(function(e){e.shiftKey||e.altKey||e.metaKey||!e.ctrlKey||77!==e.which||(!u||u())&&d()}),setTimeout(function(){var e=($("#wmd-button-bar"+t),$("#wmd-image-button"+t)),i=parseInt(e.css("left"));e.nextAll("li").each(function(){var e=$(this),t=parseInt(e.css("left"));e.css("left",t+25)});var n=$("<li class='wmd-button wmd-"+s+"-button' style='left:"+(i+25)+"px' id='wmd-"+s+"-button"+t+"' title='"+r+" Ctrl-M' />").insertAfter(e),a=!1,o=$("<span />").css({"backgroundImage":"url("+c+")"}).appendTo(n).on("touchend",function(){a=!0}).click(function(){return a?(alert(x),a=!1,void 0):(a=!1,(!u||u())&&d(),void 0)});$.browser.msie&&o.mousedown(function(){m=v.caret()})},0)}function i(e){return('\n\n<!-- Begin {THING}: In order to preserve an editable {THING}, please\n     don\'t edit this section directly.\n     Click the "edit" link below the image in the preview instead. -->\n\n![{THING}]('+e+")\n\n<!-- End {THING} -->\n\n").replace(/{THING}/g,s)}var s=e.thingName,n=e.thingFinder,a=e.getIframeUrl,o=e.getDivContent,r=e.buttonTooltip,c=e.buttonImageUrl,l=e.onShow,h=e.onRemove||function(){},u=e.checkSupport;StackExchange.MarkdownEditor.creationCallbacks.add(t)}return{"init":e}}();